#  DNS enhanced (智能 DNS 增强配置)

本项目是一个为 [Surge](https://nssurge.com/) 等网络工具设计的智能 DNS 增强配置文件。其核心目标是通过精细化的域名分流策略，为不同的网络服务选择最高效、最准确的 DNS 服务器，从而优化网络请求速度、提高解析成功率并增强网络体验。

## 核心理念

本配置遵循三大原则：

1.  **域名按归属分流**：将不同国家或地区的互联网服务（如 Google, Apple, 阿里巴巴, 腾讯）的域名解析请求，分别发送至其各自或指定的 DNS 服务器。这确保了能够获取到针对用户所在区域最优化的 CDN 节点，大幅提升访问速度。
2.  **局域网地址本地解析**：所有路由器后台管理页面（如 `router.asus.com`, `tplogin.cn`）以及其他局域网设备的域名，均通过系统默认的 DNS (`syslib`) 进行解析。这保证了内网设备的访问永远正确。
3.  **特殊地址规范解析**：对一些特定的服务（如 Google API, Apple 服务）采用其官方推荐的 DNS 服务进行解析，保证服务的稳定性和可用性。

## 主要功能与实现细节

### 1. DNS 服务器预解析

在 `[Host]` 部分，配置文件预先将所有将要用到的加密 DNS 服务器域名（如 `dns.google`, `dns.alidns.com`）指向其固定的 IP 地址。这是一个关键的“自举”设计，避免了在解析一个域名时，又需要去请求另一个域名而产生的“鸡生蛋，蛋生鸡”的循环解析问题。

### 2. 精细化的域名分流规则

这是本配置文件的核心。通过 `域名 = server:DNS服务器` 的语法，实现了对海量域名的精细化管理。

-   **中国大陆服务**：
    -   **阿里巴巴、蚂蚁集团、淘宝、阿里云**等：使用 `quic://dns.alidns.com` (阿里公共 DNS) 解析。
    -   **腾讯、QQ、微信、腾讯云**等：使用 `https://doh.pub/dns-query` (DNSPod 公共 DNS) 解析。
    -   **百度、百度云、爱奇艺**等：使用 `180.76.76.76` (百度公共 DNS) 解析。
    -   **字节跳动、抖音、今日头条**等：使用 `180.184.1.1` (火山引擎公共 DNS) 解析。
    -   **BiliBili**：根据其视频服务器所使用的不同 CDN 服务商（阿里云、腾讯云、百度云），智能地将解析请求分发给对应的 DNS 服务器。

-   **国际与地区服务**：
    -   **Apple 服务**：如 `icloud.com`，使用苹果官方的加密 DNS `https://doh.dns.apple.com/dns-query` 解析。
    -   **路由器管理**：将全球主流路由器品牌（华硕、网件、Linksys、小米、华为等）的管理域名全部指向 `server:syslib`，交由系统处理。

### 3. 加密 DNS (Encrypted DNS)

本配置大量采用了 `DoH (DNS over HTTPS)`、`DoQ (DNS over QUIC)` 等现代加密 DNS 协议。这可以有效防止 DNS 污染和劫持，保护用户的隐私和安全。

## 如何使用

1.  将本 `dns-enhanced.conf` 文件的内容添加或 `include` 到您的 Surge 配置文件中的 `[General]` 和 `[Host]` 等相应部分。

2.  **（可选步骤）** 如果您在中国大陆并需要解析 `dns.google` 等域名，建议在您的 **主配置文件** 的 `[Rule]` 部分，添加一条规则，用于将国外的加密 DNS 服务器域名指向您的代理策略。

    ```ini
    # [Rule]
    # ... 其他规则 ...

    # >> 国外加密 DNS 服务 -> 走代理
    DOMAIN-KEYWORD,dns.google,PROXY
    DOMAIN-KEYWORD,cloudflare-dns,PROXY
    # ... etc
    ```
    **说明**：
    *   请将 `PROXY` 替换为您自己的代理策略组名称。
    *   此步骤是可选的，因为新配置中 `encrypted-dns-follow-outbound-mode` 已设为 `false`。但如果遇到解析问题，添加此规则是推荐的排查和解决方法。
